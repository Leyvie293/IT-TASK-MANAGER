<!-- templates/auth/profile.html -->
{% extends "base.html" %}

{% block title %}My Profile - {{ config.get('APP_NAME', 'IT Task Manager') }}{% endblock %}

{% block page_title %}My Profile{% endblock %}

{% block page_description %}Manage your account settings and view your activity{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 1rem;
        color: white;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 4px solid white;
        object-fit: cover;
        background-color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 3rem;
    }
    
    .stat-card {
        transition: transform 0.3s ease;
        border: none;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .activity-item {
        border-left: 3px solid transparent;
        padding: 0.75rem 1rem;
        transition: all 0.2s;
    }
    
    .activity-item:hover {
        background-color: rgba(0,0,0,0.02);
        border-left-color: #0d6efd;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="row align-items-center">
            <div class="col-md-3 text-center text-md-start">
                <div class="position-relative d-inline-block">
                    <!-- FIXED: Removed profile picture reference - using initials instead -->
                    <div class="profile-avatar">
                        <span class="text-primary fw-bold">{{ user.initials if user.initials else '??' }}</span>
                    </div>
                </div>
            </div>
            <div class="col-md-9 mt-3 mt-md-0">
                <h2 class="mb-2">{{ user.first_name }} {{ user.last_name }}</h2>
                <p class="mb-1">
                    <span class="badge {{ 'bg-danger' if user.role == 'Admin' else 'bg-primary' if user.role == 'Supervisor' else 'bg-secondary' }} me-2">
                        {{ user.role }}
                    </span>
                    {% if user.department %}
                    <span class="badge bg-light text-dark">{{ user.department }}</span>
                    {% endif %}
                </p>
                <p class="mb-2">
                    <i class="bi bi-envelope me-2"></i>{{ user.email }}
                    {% if user.phone %}
                    <br><i class="bi bi-telephone me-2"></i>{{ user.phone }}
                    {% endif %}
                </p>
                <p class="mb-0">
                    <small>
                        <i class="bi bi-calendar me-1"></i>
                        Member since {{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Unknown' }}
                        {% if user.last_login %}
                        â€¢ <i class="bi bi-clock-history ms-2 me-1"></i>
                        Last login: {{ user.last_login.strftime('%Y-%m-%d %H:%M') }}
                        {% endif %}
                    </small>
                </p>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card stat-card border-start border-primary border-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">Total Tasks</div>
                            <div class="h4 mb-0">{{ total_tasks }}</div>
                        </div>
                        <div class="bg-primary bg-opacity-10 p-3 rounded">
                            <i class="bi bi-list-task text-primary fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card border-start border-success border-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">Completed</div>
                            <div class="h4 mb-0">{{ completed_tasks }}</div>
                        </div>
                        <div class="bg-success bg-opacity-10 p-3 rounded">
                            <i class="bi bi-check-circle text-success fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card border-start border-warning border-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">In Progress</div>
                            <div class="h4 mb-0">{{ pending_tasks }}</div>
                        </div>
                        <div class="bg-warning bg-opacity-10 p-3 rounded">
                            <i class="bi bi-hourglass-split text-warning fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3 mb-3">
            <div class="card stat-card border-start border-danger border-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="text-muted small">Overdue</div>
                            <div class="h4 mb-0">{{ overdue_tasks }}</div>
                        </div>
                        <div class="bg-danger bg-opacity-10 p-3 rounded">
                            <i class="bi bi-exclamation-triangle text-danger fs-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Personal Information -->
        <div class="col-lg-5 mb-4">
            <div class="card shadow h-100">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-badge me-2"></i>Personal Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <th width="40%">Username</th>
                                    <td>{{ user.username }}</td>
                                </tr>
                                <tr>
                                    <th>Full Name</th>
                                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                                </tr>
                                <tr>
                                    <th>Email</th>
                                    <td>{{ user.email }}</td>
                                </tr>
                                {% if user.phone %}
                                <tr>
                                    <th>Phone</th>
                                    <td>{{ user.phone }}</td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>Role</th>
                                    <td>
                                        <span class="badge {{ 'bg-danger' if user.role == 'Admin' else 'bg-primary' if user.role == 'Supervisor' else 'bg-secondary' }}">
                                            {{ user.role }}
                                        </span>
                                    </td>
                                </tr>
                                {% if user.department %}
                                <tr>
                                    <th>Department</th>
                                    <td>{{ user.department }}</td>
                                </tr>
                                {% endif %}
                                {% if user.job_title %}
                                <tr>
                                    <th>Job Title</th>
                                    <td>{{ user.job_title }}</td>
                                </tr>
                                {% endif %}
                                <tr>
                                    <th>Account Status</th>
                                    <td>
                                        <span class="badge {{ 'bg-success' if user.is_active else 'bg-danger' }}">
                                            {{ 'Active' if user.is_active else 'Inactive' }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <th>Member Since</th>
                                    <td>{{ user.created_at.strftime('%B %d, %Y') if user.created_at else 'Unknown' }}</td>
                                </tr>
                                {% if user.last_login %}
                                <tr>
                                    <th>Last Login</th>
                                    <td>{{ user.last_login.strftime('%Y-%m-%d %H:%M') }}</td>
                                </tr>
                                {% endif %}
                                {% if user.login_count is not none %}
                                <tr>
                                    <th>Login Count</th>
                                    <td>{{ user.login_count }}</td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="mt-4">
                        <a href="{{ url_for('edit_profile') }}" class="btn btn-primary me-2">
                            <i class="bi bi-pencil me-1"></i>Edit Profile
                        </a>
                        <a href="{{ url_for('change_password') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-key me-1"></i>Change Password
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="col-lg-7 mb-4">
            <div class="card shadow h-100">
                <div class="card-header bg-white">
                    <h5 class="mb-0">
                        <i class="bi bi-clock-history me-2"></i>Recent Activity
                    </h5>
                </div>
                <div class="card-body">
                    {% if recent_activities %}
                    <div class="list-group list-group-flush">
                        {% for activity in recent_activities %}
                        <div class="list-group-item border-0 px-0 py-3 activity-item">
                            <div class="d-flex justify-content-between align-items-start mb-1">
                                <div>
                                    <span class="fw-bold">
                                        {% if activity.activity_type %}
                                            {{ activity.activity_type }}
                                        {% else %}
                                            Activity
                                        {% endif %}
                                    </span>
                                    <span class="text-muted ms-2">
                                        {% if activity.created_at %}
                                            {{ activity.created_at.strftime('%Y-%m-%d') }}
                                        {% endif %}
                                    </span>
                                </div>
                                <small class="text-muted">
                                    {% if activity.created_at %}
                                        {{ activity.created_at.strftime('%H:%M') }}
                                    {% endif %}
                                </small>
                            </div>
                            
                            {% if activity.description %}
                            <p class="mb-1 text-muted">{{ activity.description|truncate(100) }}</p>
                            {% endif %}
                            
                            {% if activity.status %}
                            <span class="badge {{ 'bg-success' if activity.status == 'success' else 'bg-danger' if activity.status == 'failed' else 'bg-warning' }} mt-1">
                                {{ activity.status|title }}
                            </span>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-activity fs-1 text-muted mb-3"></i>
                        <h5 class="text-muted">No recent activity</h5>
                        <p class="text-muted">Your activity will appear here as you use the system.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}